import json
from pwn import *

payload = b'which one of you guys drank all my beer????????????????????????????' # added ? to get whole flag

io = remote('206.189.117.93', 32017)

print(io.recvuntil(b'> ', timeout=5))
io.sendline(b'{"option":"3"}')

print(io.recvuntil(b'modes:', timeout=5))
io.sendline(b'{"modes":["CTR"]}')

print(io.recv())
io.sendline(b'{"option":"1"}')

print(io.recvuntil(b'{', timeout=5))
cipher_flag = json.loads((b'{' + io.recvuntil(b'}', timeout=5)).decode().strip())['ciphertext']

print(io.recvuntil(b'> ', timeout=5))
io.sendline(b'{"option":"2"}')

print(io.recvuntil(b'plaintext:', timeout=5))
io.sendline(b'{"plaintext":"' + payload + b'"}')

print(io.recvuntil(b'\n'))
cipher_payload = json.loads(io.recv().decode().strip())['ciphertext']

print('--------------------------')
print(f'flag    ({len(cipher_flag)} bytes) =', cipher_flag)
print(f'payload ({len(cipher_payload)} bytes) =', cipher_payload)

blob = xor(binascii.unhexlify(cipher_flag), binascii.unhexlify(cipher_payload))
flag = xor(blob, payload)
print(f'{flag=}')

# io.interactive()
