# spider-shambles

A completely ordinary file scrambler without any purpose of existence or something idk.

## Solution

https://github.com/TCP1P/TCP1P-CTF-2023-Challenges/tree/main/Cryptography/Spider%20Shambles/writeup

A good ol' mersenne problem. Abuse the random module vulnerability to predict upcoming bytes.

Summary: In this ugly website, user can upload file and server will return it encrypted by xorring it with random bytes generated by random module. The objective here is to decrypt the flago.jpg (located at /flago), which was encrypted by the same algorithm.

Attack idea:

1. Upload any file that have enough bytes (for me is 2496 bytes)
2. Retrieve the encrypted file
3. Retrieve the encrypted flago file
4. xor the encrypted with the original to get the xor key.
5. Feed randcrack module with the xor key bytes so it will predict the xor key used to encrypt the flago
6. Decrypt the encrypted flago with that xor key. Flag!

```py
from Crypto.Util.number import *
from mt19937predictor import MT19937Predictor
import random
from pwn import *

plain = open('material.png', 'rb').read()
xored = open('lalalalululu', 'rb').read()
flago = open('babababububu', 'rb').read()

predictor = MT19937Predictor()
res = bytes_to_long(xor(plain, xored))
predictor.setrandbits(res, 19968)

key = predictor.getrandbits(len(flago)*8)
dec = open('hasil', 'wb')
dec.write(xor(flago, long_to_bytes(key)))
```
